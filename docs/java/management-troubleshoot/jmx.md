# 第一部分 Java管理扩展技术用户指南
> https://docs.oracle.com/en/java/javase/11/jmx/index.html#GUID-E409CC44-9A8F-4043-82C8-6B95CD939296
### JMX技术概述
Java管理扩展（英语：Java Management Extensions，简称：JMX）技术最初是通过Java社区进程（英语：Java Community Process，简称：JCP）开发的，如Java规范请求（Java Specification Request，简称：JSR）3，Java管理扩展，以及JSR 160，JMX远程API。JMX API是用于管理和监视资源（如应用程序、设备、服务和Java虚拟机）的标准API。

JMX技术的典型应用包括：
- 监控和更改应用程序配置
- 积累有关应用程序行为的统计信息并使其可用
- 发送状态更改和错误条件的通知。

JMX API包括远程访问，因此远程管理应用程序可以与正在运行的应用程序交互以执行这些操作。

## 1. JMX技术简介
如果您已经熟悉Java管理扩展（JMX）技术，请参阅JMX技术版本以了解版本信息。

JMX技术提供了一种管理资源（如应用程序、设备和服务）的简单、标准的方法。由于JMX技术是动态的，因此可以在创建、安装和实现资源时使用它来监视和管理资源。您还可以使用JMX技术来监视和管理Java虚拟机（Java VM）。

JMX技术是通过Java Community Process（JCP）开发的，作为两个密切相关的Java Specification Request（JSR）：
- JSR 3：Java管理扩展（JMX）规范
- JSR 160：Java管理扩展（JMX）远程API

JSR由Javadoc工具生成的API文档以及每个JSR的PDF规范文档定义。

正如其名称所示，JMXRemote API为JMX规范添加了远程功能，使您能够远程监视和管理应用程序、系统和网络。在本指南中，术语“JMX技术”用于描述JMX规范和JMX Remote API。

本章在以下几节中介绍了JMX技术：
- 什么是JMX技术
- 为什么要使用JMX技术

### 什么是JMX技术
JMX规范用Java编程语言定义了体系结构、设计模式、API以及用于应用程序和网络管理与监控的服务。

通过使用JMX技术，一个或多个称为托管Bean（ManagedBean，MBeans）的Java对象可以对指定的资源进行检测。这些MBean在核心托管对象服务器（称为MBean服务器）中注册。MBean服务器充当管理代理，可以在支持Java编程语言的大多数设备上运行。

规范定义了可用于管理根据规范进行检测的资源的JMX代理。JMX代理由一个注册了MBean的MBean服务器和一组用于处理MBean的服务组成。JMX代理直接控制资源并使它们可用于远程管理应用程序。

对资源进行检测的方式完全独立于管理基础架构。因此，无论资源的管理应用程序是如何实现的，都可以使资源变得可管理。

JMX技术定义了标准连接器（JMX连接器），使您能够从远程管理应用程序访问JMX代理。JMX连接器使用不同的协议来提供相同的管理接口。管理应用程序可以透明地管理资源，而不管所使用的通信协议。不符合JMX规范但支持JMX代理的系统和应用程序可以使用JMX代理。

### 为什么要使用JMX技术
JMX技术为所有行业的Java开发人员提供了一种灵活的方法，可以插入Java代码，创建智能Java代理，实现分布式管理中间件和管理器，并将这些解决方案顺利集成到现有的管理和监控系统中。

- **JMX技术使Java应用程序的管理不需要大量的投资**：一个JMX技术代理可以在大多数支持Java技术的设备上运行，因此Java应用程序可以变得易于管理，而对它们的设计几乎没有影响。Java应用程序只需要嵌入一个托管对象服务器，并使它的一些功能作为一个或多个在对象服务器中注册的托管bean（MBeans）可用;这就是它从管理基础结构中受益所需的全部内容。
- **JMX技术为管理基于Java技术的应用程序、系统和网络提供了一种标准方法**：例如，Java Platform，Enterprise Edition（Java EE）5 Application Server符合JMX体系结构，因此可以使用JMX技术进行管理。
- **JMX技术可用于Java虚拟机（JVM）的开箱即用管理**：JVM使用JMX技术进行高度工具化。您可以轻松地启动一个JMX代理来访问内置的JVM工具，并远程监视和管理JVM。
- **JMX技术提供了一个可扩展的、动态的管理体系结构**：每个JMX代理服务都是一个可以插入管理代理的独立模块。这种基于组件的方法意味着JMX解决方案可以从小型设备扩展到大型电信交换机等。JMX规范提供了一组核心代理服务。可以在管理基础设施中开发并动态加载、卸载或更新其他服务。
- **JMX技术利用了现有的标准Java技术**：在需要时，JMX规范引用现有的Java规范，例如Java目录和目录接口（JNDI）。
- **NetBeans IDE的JMX模块使创建JMX应用程序变得更加容易**：您可以从NetBeans更新中心获取JMX模块。
- **JMX技术与现有的管理解决方案和新兴技术集成**：例如，可以通过HTML浏览器管理JMX代理。JMXAPI提供了任何管理系统供应商都可以使用的开放接口。JMX解决方案可以使用查找和发现服务和协议，如Jini技术和服务定位协议（SLP）。

## 2 JMX技术架构
Java管理扩展（JMX）技术为资源的管理和监视提供了标准的API。API包括远程访问，使得远程管理应用可以管理和监视应用、系统和网络。

本章在以下几节中概述了JMX体系结构：
- 架构概要
- 使用MBeans检测资源
- 创建JMX代理
- 远程管理资源

### 架构概要
JMX技术是通过Java Community Process（JCP）开发的，作为两个密切相关的Java Specification Request（JSR）：
- JSR 3：Java管理扩展（JMX）规范
- JSR 160：Java管理扩展（JMX）远程API

下表显示了管理体系结构中的级别。工具和代理级别由JSR 3定义。远程管理级别由JSR 160定义。

### 使用MBeans检测资源
要使用JMX技术管理资源，必须首先使用Java编程语言对资源进行插装。您可以使用称为MBean的Java对象来实现对资源插装的访问。MBeans必须遵循在JMX规范中定义的设计模式和接口，以确保所有MBeans都以标准化的方式提供托管资源的插装。

在通过MBeans对资源进行检测之后，可以通过JMX代理对其进行管理。MBeans不需要了解与它们一起操作的JMX代理。

MBeans被设计为灵活、简单和易于实现。应用程序、系统和网络的开发人员可以使他们的产品以标准的方式进行管理，而无需投资于复杂的管理系统。现有资源可以用最少的努力加以管理。

此外，JSR 3：Java管理扩展（JMX）规范的插装级别指定了一种通知机制，该机制使MBeans能够生成通知事件并将其传播到其他级别的组件。

### 创建JMX代理
JMX代理是一种标准的管理代理，它直接控制资源并使资源可供远程管理应用程序使用。JMX代理通常与它所控制的资源位于同一个系统上，但这不是必需的。

JMX代理的核心组件是MBean服务器，它是注册了MBean的托管对象服务器。JMX代理还包括一组用于管理MBean的服务，以及至少一个用于允许管理应用程序访问的通信适配器或连接器。

在实现JMX代理时，您不需要知道代理将用于管理的资源的语义或功能。实际上，一个JMX代理甚至不需要知道它将服务于哪些资源，因为任何符合JMX规范的资源都可以使用任何提供它所需服务的JMX代理。此外，代理不需要知道将访问它的管理应用程序的功能。

### 远程管理资源
可以通过现有的管理协议（如简单网络管理协议（SNMP））或通过专有协议来访问JMX API工具。MBean服务器依赖于协议适配器和连接器来使代理的JVM外部的管理应用程序可以访问JMX代理。

每个适配器都通过特定协议提供在MBean服务器中注册的所有MBean的视图。例如，HTML适配器可以在浏览器中显示MBean。

连接器提供管理器端接口，用于处理管理器和JMX代理之间的通信。每个连接器提供相同的远程管理接口，但协议不同。当远程管理应用程序使用此接口时，它可以通过网络透明地连接到JMX代理，而不考虑协议。

JMX技术基于远程方法调用（RMI），为将JMX API插装导出到远程应用程序提供了标准解决方案。JMX Remote API还定义了一个直接基于TCP套接字的可选协议，称为JMX消息传递协议（JMXMP）。JMX Remote API的实现不必支持此可选协议。Java SE平台不包括可选协议。有关详细信息，请参阅JMX技术版本。

规范的JMXRemote API部分描述了如何通过使用现有的发现和查找基础结构来通告和查找JMX代理。有关示例，请参见Java管理扩展（JMX）技术教程。JMX规范没有定义自己的发现和查找服务。使用现有的发现和查找服务是可选的。或者，您可以将JMX代理的地址编码为URL的形式，然后将这些URL传递给管理器。

## 3 为您的资源配置JMX技术
本章在以下各节中概述了使用JMX技术检测资源以进行管理的概念：
- 可管理资源
- 托管Bean（MBeans）
- JVM插装

### 可管理资源

可以使用JMX技术管理不同类型的资源，例如应用程序、服务的实现、设备或用户。对于要由JMX技术管理的给定资源，它必须用Java语言开发，或者至少提供Java语言包装器。该资源还必须由一个或多个Java对象（称为托管bean（MBeans））进行检测，以符合JMX规范。

应用程序和设备的开发人员可以选择被插装为MBean的对象的粒度。MBean可能代表应用程序中最小的对象，也可能代表整个应用程序。在设计应用程序组件时考虑到它们的管理接口，通常可以将它们编写为MBean。MBean可以用作没有管理接口的遗留代码的包装器，也可以用作具有遗留管理接口的代码的代理。

### 托管Bean（MBeans）
实现资源及其插装的Java对象称为托管bean（MBeans）。MBean必须遵循[Java管理扩展（JMX）规范1.4版](https://docs.oracle.com/javase/8/docs/technotes/guides/jmx/JMX_1_4_specification.pdf)中定义的设计模式和接口，以确保所有MBean都以标准化的方式提供托管资源的插装。

给定资源的插装由一个或多个标准或动态的MBean提供。标准MBean是符合从JavaBean组件模型派生的某些设计模式的Java对象。动态MBeans遵循在运行时提供更大灵活性的特定接口。MXBean只引用一组预定义的类型。

通过对资源进行检测，可以通过使用JMX代理中所述的代理级别对其进行管理。MBeans不需要了解与它们一起操作的[JMX代理](#4-使用jmx代理)。

MBeans被设计为灵活、简单和易于实现。应用程序、服务或设备的开发人员可以使他们的产品以标准的方式进行管理，而无需了解或投资于复杂的管理系统。现有的对象可以很容易地演化为标准的MBean或包装为动态的MBean，从而使现有的资源可以用最少的工作量进行管理。

检测级别指定一种通知机制，该机制使MBean能够生成通知事件并将其传播到其他级别的组件。

MBean的管理接口包括：

- 可以读取和/或写入的命名和类型化属性
- 可以调用的命名操作和类型化操作
- 可以由MBean发出的类型化通知

标准MBean的Java类通过其属性和操作直接公开要管理的资源。属性是通过getter和setter方法公开的内部实体。操作是类中可供管理器使用的其他方法。所有这些方法都是在MBean接口中静态定义的，并且通过内省对JMX代理可见。这是使新资源易于管理的最直接的方法。

动态MBean在运行时定义其管理接口。例如，配置MBean可以通过解析XML文件来确定它所公开的属性的名称和类型。

MXBean是一种类型的MBean，它提供了一种简单的方法来编写只引用预定义类型集的MBean。通过这种方式，可以确保任何客户端（包括远程客户端）都可以使用您的MBean，而不需要客户端访问表示您的MBean类型的特定于模型的类。

### JVM插装
JVM是使用JMX技术高度工具化的。您可以轻松地启动一个JMX代理来访问内置的JVM插装，从而通过JMX技术远程监控和管理JVM。

要了解有关使用JMX技术监视和管理JVM的更多信息，请参阅Java Platform，Standard Edition Management Developer's Guide。

## 4 使用JMX代理
JMX代理是在JVM中运行的管理实体，充当受管Bean（MBeans）和管理应用程序之间的联系人。以下各节概述了JMX代理的各种组件：

- MBean服务器
- 代理服务
- 协议适配器和连接器
- 服务器

MBean服务器是JMX代理的核心组件。它是JMX代理中向管理操作公开的对象的注册表。注册到MBean服务器的对象对管理应用程序可见。MBean服务器只公开MBean的管理接口，而不公开其直接对象引用。

您想要从代理的JVM外部管理的任何资源都必须在服务器上注册为MBean。MBean服务器提供了一个标准化的接口，用于访问同一JVM中的MBean，从而使本地对象具有操作可管理资源的所有优点。可以通过以下方式实例化和注册MBean：

- 另一个MBean
- 代理本身
- 远程管理应用

注册MBean时，必须为它分配一个唯一的对象名。管理应用程序使用对象名称来标识要对其执行管理操作的对象。MBean上可用的操作包括：

- 发现MBeans的管理接口
- 阅读和写入其属性值
- 执行由MBean定义的操作
- 获取由MBean发出的通知
- 使用对象名或属性值查询MBean

### 代理服务
代理服务是可以在注册到MBean服务器的MBean上执行管理操作的对象。通过在代理中包含管理智能，JMX使您能够构建更强大的管理解决方案。代理服务也可以由MBean提供，允许通过MBean服务器控制它们及其功能。Java管理扩展（JMX）规范1.4版定义了以下代理服务：

- **动态类加载器**：通过管理小程序（m-let）服务的动态类加载检索并实例化从网络动态下载的新类和本机库。
- **标记**：标记MBean属性的数值或字符串值，并可以通知其他对象几种类型的更改。
- **定时器**：定时器提供了一种调度机制，可以按预定的时间间隔发送通知。
- **关系服务**：关系服务定义了MBeans之间的关联，并维护关系的一致性。

### 协议适配器和连接器
协议适配器和连接器使代理可以从远程管理应用程序访问。它们通过特定协议提供了实例化并注册到MBean服务器的MBean的视图。它们使JVM外部的管理应用程序能够：

- **获取或设置现有MBean的属性**
- **对现有的MBean执行操作**
- **实例化并注册新的MBean**
- **注册并接收由MBean发出的通知**

因此，要使JMX代理易于管理，它必须至少包括一个协议适配器或连接器。Java SE平台包括标准的远程方法调用（RMI）连接器。代理可以包括一个或多个协议适配器和连接器，允许同时通过不同的协议对其进行远程管理和监控。

### 协议适配器
协议适配器通过给定的协议提供JMX代理的管理视图。它们使MBean和MBean服务器的操作适应于给定协议中的表示，并且可能适应于不同的信息模型，例如SNMP。Java SE平台不包括任何标准协议适配器。

连接到协议适配器的管理应用程序通常特定于给定的协议。对于依赖于特定管理协议的传统管理解决方案来说，这是典型的情况。它们访问JMX代理不是通过MBean服务器的远程表示，而是通过映射到MBean服务器的操作。

### 连接器
连接器用于将代理与启用了JMX技术的远程管理应用程序（即，使用JMX规范的分布式服务开发的管理应用程序）连接。这种通信涉及代理中的连接器服务器和管理器中的连接器客户端。

这些组件通过特定的协议以点对点的方式透明地传递管理操作。JMXRemote API提供了到MBean服务器的远程接口，管理应用程序可以通过该接口执行操作。连接器是特定于给定协议的，但管理应用程序可以无差别地使用任何连接器，因为远程接口是相同的。

有关标准JMX连接器的更多信息，请参见使用JMX连接器远程管理资源。

## 5 使用JMX连接器远程管理资源
Java管理扩展（JMX）规范1.4版的Java管理扩展工具规范和代理规范部分定义了连接器的概念。连接器使远程的基于Java技术的客户机可以访问JMX技术的MBean服务器。连接器的客户端导出与MBean服务器基本相同的接口。

连接器由连接器客户端和连接器服务器组成。连接器服务器连接到一个MBean服务器，并侦听来自客户端的连接请求。连接器客户端与连接器服务器建立连接。连接器客户端通常与连接器服务器在不同的JVM中，并且通常运行在不同的机器上。

许多连接器实现是可能的。特别是，用于通过客户端和服务器之间的连接进行通信的协议有许多可能性。

连接器服务器通常有一个地址，用于在连接器客户端和连接器服务器之间建立连接。或者，一些连接器可以提供连接短截线以建立连接。建立连接的方式取决于您使用的发现和查找技术。请参阅发现和搜索服务。

本章概述了Java管理扩展（JMX）规范1.4版的“JMX远程API规范”部分定义的不同类型的连接器及其使用的协议，具体如下：

- RMI连接器：标准的远程方法调用（RMI）协议必须得到符合JMX远程API规范的每个实现的支持。
- 通用连接器：“JMX Remote API Specification”部分还定义了一个直接基于TCP套接字的可选协议，称为“JMX Messaging Protocol（JMXMP）”。规范的实现可以省略JMXMP连接器，但不能省略RMI连接器。Java SE平台不包括可选的JMXMP连接器。
- 用户定义的协议：连接器还可以实现未在JMX规范中定义的协议。

### RMI连接器
JMX Remote API定义了一个基于RMI的标准协议。RMI连接器必须存在于每个JMX Remote API实现中。

RMI连接器支持Java远程方法协议（JRMP）传输。

JRMP上的RMI连接器提供了一种简单的机制，用于保护和验证客户端和服务器之间的连接。这种机制为使用RMI连接器的环境提供了基本的安全级别。请注意，通用的JMXMP连接器提供了更高级的安全性。

您可以通过使用RMI套接字工厂来提高RMI连接器在JRMP上的安全性，以便客户端和服务器之间的连接使用安全套接字层（SSL）。

### 通用连接器
JMX Remote API定义了一个可选的通用连接器，Java SE平台中不包括该连接器。可以通过添加可插拔模块来配置此连接器，以定义以下内容：

- 用于将请求从客户端发送到服务器以及将响应和通知从服务器发送到客户端的传输协议
- 从客户端发送到服务器的对象的对象包装，这些对象的类加载器可以依赖于目标MBean

JMX消息传递协议（JMXMP）连接器是通用连接器的一种配置，其中传输协议基于TCP，对象包装是本机Java序列化。安全性比RMI连接器更高级。安全性基于Java安全套接字扩展（JSSE）、Java身份验证和授权服务（JAAS）以及简单身份验证和安全层（SASL）。

通用连接器及其JMXMP配置是可选的，这意味着它们并不总是包含在JMX Remote API的实现中。Java SE平台不包括可选的通用连接器。

### 用户自定义协议
JMX Remote API并不为每个协议定义连接器。您可以基于未在JMX Remote API中定义的协议实现连接器。例如，您可以基于使用HTTP/S的协议实现连接器。JMX规范描述了如何基于用户定义的协议实现连接器。

## 6 发现和搜索服务
Java管理扩展（JMX）规范1.4版描述了如何通过使用现有的发现和查找基础结构来通告和查找JMX API代理。该规范没有定义任何特定于JMX技术的发现和查找API。

本章简要概述了可以与JMX技术一起使用的现有发现和查找基础结构。

### 开始使用Oracle服务
JMX代理和JMX客户端可以使用查找服务。单个JVM可以包含多个JMX代理和/或JMX客户端。

JMX代理是由以下功能组成的逻辑服务器应用程序：

- 一个托管Bean（MBean）服务器
- 一个或多个允许远程客户端访问该MBean服务器中包含的MBean的JMX连接器服务器

JMX客户端是一个逻辑客户端应用程序，它打开与JMX代理的客户端连接。

Java管理扩展（JMX）技术教程演示了如何使用查找服务来通告和查找JMX代理。

> :warning: 注意：使用现有的发现和查找服务是可选的。或者，您可以将您的JMX API代理的地址编码为URL的形式，并将这些URL传递给管理器。

### 使用服务定位协议（SLP）

服务定位协议（SLP）提供了一个框架，允许网络应用程序发现企业网络中网络服务的存在、位置和配置。

以下步骤总结了在JMX规范中定义的使用SLP查找服务来通告和查找JMX代理的过程：

- JMX代理创建一个或多个JMX连接器服务器。
- 对于每个公开的连接器，JMX代理向SLP查找服务注册地址，可能会提供附加属性来限定代理和/或连接器，并可用作筛选器。
- JMX客户机查询SLP查找服务，并检索与查询匹配的一个或多个地址。
- 最后，JMX客户端获取一个连接器，该连接器与由检索到的地址标识的服务器相连。
- 在JMX规范中，JMX远程API规范部分定义了与SLP协议兼容的URL方案。该规范还定义了注册时提供的强制性和可选SLP查找属性。

### 在LDAP后端中使用Java LDAP和目录接口（JNDI）API

Java目录和目录接口（JNDI）API是Java平台的标准扩展。它为支持Java技术的应用程序提供了到多个命名和目录服务的统一接口。

JMX规范描述了如何使用LDAP服务器来存储和检索有关由JMX代理公开的JMX连接器的信息。

以下步骤总结了在JMX规范中定义的使用JNDI查找服务的过程：

- JMX代理创建一个或多个JMX连接器服务器。
- 对于要公开的每个连接器，JMX代理向JNDI查找服务注册地址，可能会提供附加属性来限定代理和/或连接器，并可用作过滤器。
- JMX客户机查询JNDI查找服务，并检索与查询匹配的一个或多个地址。
- 最后，JMX客户端获得一个连接器，该连接器连接到由检索到的地址标识的服务器。

在JMX规范中，JMX Remote API规范部分定义了用于注册地址的LDAP模式，并解释了客户端如何发现已注册的代理。该规范还定义了一种租赁机制。

## 7 JMX技术版本
Java管理扩展技术（Java Management Extensions Technology，JMX）在Java平台标准版（Java SE）5.0中成为Java平台的标准部分。JMX技术是通过Java Community Process（JCP）作为两个密切相关的Java Specification Request（JSR）开发的。Java SE 5.0中实现的JSR版本将在以下部分中详细介绍。

### JMX工具和代理规范（JSR 3）
Java SE 9和更高版本的平台实现了JMX规范（维护版本，2006年10月）的1.4版。它包含了下载时提供的勘误表中列出的修改。

### JMX远程API规范（JSR 160）
Java SE 9和更高版本的平台实现了JMX Remote API规范（维护版本，2006年10月）的1.4版。

除了标准的RMI连接器之外，JSR 160还基于TCP套接字定义了可选的JMX消息传递协议（JMXMP）连接器。Java SE平台不包括这些可选连接器。如果需要更高级的安全级别，您可能需要使用JMXMP连接器。

如果要使用JMXMP连接器：

1. 从Java平台技术下载页面下载Java管理扩展（JMX）远程API参考实现1.0.1_03。
2. 将`jmxremote_optional.jar`文件添加到类路径。

您将在JSR 160参考实现中包含的JMX Remote API中找到使用JMXMP连接器的示例。

## 8 Java管理扩展（JMX）API规范
Java管理扩展（JMX）API是用于管理和监视的标准API。

JavaDoc工具为JMX API提供了以下文档包：

- javax.management
- javax.management.loading
- javax.management.modelmbean
- javax.management.monitor
- javax.management.openmbean
- javax.management.relation
- javax.management.remote
- javax.management.remote.rmi
- javax.management.timer

# 第二部分 Java管理扩展（JMX）技术